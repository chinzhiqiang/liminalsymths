<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>liminalsynths</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <main class="landing" aria-label="liminalsynths landing">
    <img id="logo" class="logo-drop" src="assets/logo.svg" alt="liminalsynths logo" />

    <nav class="mini-nav" aria-label="site">
      <a class="mini-pill" href="about.html">about</a>
      <a class="mini-pill" href="work.html">work</a>
      <a class="mini-pill" href="contact.html">contact</a>
      <span class="mini-pill is-text">by zhigiangchin</span>
    </nav>
  </main>

  <script>
    window.addEventListener("load", () => {
      const el = document.getElementById("logo");
      if (!el) return;

      const rand = (min, max) => Math.random() * (max - min) + min;

      // --- 隨機參數 ---
      const x = rand(-160, 160);
      const rot = rand(6, 14) * (Math.random() < 0.5 ? -1 : 1) * -1;
      const over = rand(16, 36);
      const b1 = -rand(8, 20);
      const b2 = rand(2, 10);
      const b3 = -rand(1, 7);

      el.style.setProperty("--x", `${x}px`);
      el.style.setProperty("--rot", `${rot}deg`);
      el.style.setProperty("--over", `${over}px`);
      el.style.setProperty("--b1", `${b1}px`);
      el.style.setProperty("--b2", `${b2}px`);
      el.style.setProperty("--b3", `${b3}px`);
      el.style.setProperty("--lift", `0px`);

      // --- 重播掉落 ---
      el.classList.remove("is-landed");
      el.classList.remove("logo-drop");
      void el.offsetWidth;
      el.classList.add("logo-drop");

      // 掉落結束 → 開放互動
      const onAnimEnd = () => {
        el.classList.add("is-landed");
        el.removeEventListener("animationend", onAnimEnd);
      };
      el.addEventListener("animationend", onAnimEnd);

      // --- 互動參數 ---
      const HIT = 110;
      const MAX_LIFT = 120;
      let lifting = false;

      let y = 0;
      let v = 0;
      let target = 0;
      let raf = 0;

      function apply() {
        el.style.setProperty("--lift", `${y}px`);
      }

      function tick() {
        const k = 0.12;
        const d = 0.78;
        v = (v + (target - y) * k) * d;
        y += v;

        if (Math.abs(v) < 0.05 && Math.abs(target - y) < 0.2) {
          y = target;
          v = 0;
          apply();
          raf = 0;
          return;
        }

        apply();
        raf = requestAnimationFrame(tick);
      }

      function setTarget(next) {
        target = next;
        if (!raf) raf = requestAnimationFrame(tick);
      }

      function isHit(e) {
        if (!el.classList.contains("is-landed")) return false;

        const rect = el.getBoundingClientRect();
        const inX = e.clientX >= rect.left && e.clientX <= rect.right;
        const inBottom = e.clientY >= (window.innerHeight - HIT) && e.clientY <= window.innerHeight;
        return inX && inBottom;
      }

      function onMove(e) {
        const hit = isHit(e);

        if (hit) {
          lifting = true;
          const depth = Math.max(0, Math.min(HIT, window.innerHeight - e.clientY));
          const t = depth / HIT;
          const lift = -(20 + t * (MAX_LIFT - 20));
          setTarget(lift);
        } else {
          if (lifting) {
            lifting = false;
            setTarget(0);
          }
        }
      }

      window.addEventListener("pointermove", onMove, { passive: true });
    });
  </script>
</body>
</html>
