<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>liminalsynths</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <main class="landing">

    <img id="logo" class="logo-drop" src="assets/logo.svg" alt="liminalsynths logo" />

    <nav class="mini-nav">
      <a class="mini-pill" href="#">about</a>
      <a class="mini-pill" href="#">work</a>
      <a class="mini-pill" href="#">contact</a>
      <span class="mini-pill is-text">by zhigiangchin</span>
    </nav>

  </main>

<script>
window.addEventListener("load", () => {
  const el = document.getElementById("logo");
  if (!el) return;

  const rand = (min, max) => Math.random() * (max - min) + min;

  // 初始隨機傾斜與卡邊
  const x = rand(-160, 160);
  const rot = rand(6, 14) * (Math.random() < 0.5 ? -1 : 1) * -1;

  el.style.setProperty("--x", `${x}px`);
  el.style.setProperty("--rot", `${rot}deg`);

  // 強制重播掉落
  el.classList.remove("logo-drop");
  void el.offsetWidth;
  el.classList.add("logo-drop");

  el.addEventListener("animationend", function onEnd(){
    el.classList.add("is-landed");
    el.removeEventListener("animationend", onEnd);
    startPhysics();
  });

  function startPhysics(){

    let y = 0, vy = 0;
    let a = 0, va = 0;
    let ty = 0, ta = 0;

    let dragging = false;
    let grabOffsetX = 0;

    const kY = 0.14;
    const dY = 0.78;
    const kA = 0.10;
    const dA = 0.74;

    const maxLift = 220;
    const maxTilt = 16;

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    function apply(){
      el.style.setProperty("--lift", `${y}px`);
      el.style.setProperty("--tilt", `${a}deg`);
    }

    function tick(){
      vy = (vy + (ty - y) * kY) * dY;
      y += vy;

      va = (va + (ta - a) * kA) * dA;
      a += va;

      if (y > 0){ y = 0; vy *= -0.35; }

      apply();
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    function hitTest(e){
      const r = el.getBoundingClientRect();
      return e.clientX >= r.left && e.clientX <= r.right &&
             e.clientY >= r.top && e.clientY <= r.bottom;
    }

    function onDown(e){
      if (!hitTest(e)) return;
      dragging = true;
      const r = el.getBoundingClientRect();
      grabOffsetX = (e.clientX - (r.left + r.right)/2) / (r.width/2);
      e.preventDefault();
    }

    function onMove(e){
      if (!dragging) return;

      const lift = -clamp((window.innerHeight - e.clientY) * 0.9, 0, maxLift);
      ty = lift;

      ta = clamp(grabOffsetX * maxTilt, -maxTilt, maxTilt);
    }

    function onUp(){
      if (!dragging) return;
      dragging = false;
      ty = 0;
      ta = 0;
    }

    window.addEventListener("pointerdown", onDown);
    window.addEventListener("pointermove", onMove);
    window.addEventListener("pointerup", onUp);
    window.addEventListener("pointercancel", onUp);
  }
});
</script>

</body>
</html>
